version: "3.1"

rules:
# ============================================================================
# 1. GREETING & FAREWELL RULES
# ============================================================================
- rule: Greet user
  steps:
  - intent: greet
  - action: utter_greet

- rule: Say goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye

# ============================================================================
# 2. CHITCHAT RULES
# ============================================================================
- rule: Respond to thanks
  steps:
  - intent: thank_you
  - action: utter_you_are_welcome

- rule: Respond to bot challenge
  steps:
  - intent: bot_challenge
  - action: utter_i_am_bot

# ============================================================================
# 3. CORE ACTIONS - ALWAYS HANDLE (Fix Story Conflict)
# ============================================================================
# These rules allow repeated actions regardless of conversation context
# This fixes the "Ask 2 times crash" bug

- rule: Always search products
  steps:
  - intent: search_product
  - action: action_search_products

- rule: Always track order
  steps:
  - intent: track_order
  - action: action_track_order

- rule: Check delivery status
  steps:
  - intent: check_delivery_status
  - action: action_get_delivery_status

# ============================================================================
# 4. FALLBACK & GEMINI AI RULES
# ============================================================================
- rule: Fallback rule - low confidence
  steps:
  - intent: nlu_fallback
  - action: action_ask_gemini

- rule: Ask Gemini for open-ended queries
  steps:
  - intent: open_ended_query
  - action: action_ask_gemini

- rule: Ask Gemini for advice
  steps:
  - intent: ask_advice
  - action: action_ask_gemini_with_history

- rule: Ask Gemini for general questions
  steps:
  - intent: ask_general_question
  - action: action_ask_gemini

# Removed: Legacy fallback (conflicts with "Fallback rule - low confidence")
# Now using Gemini AI for all fallback scenarios

# ============================================================================
# 4.5 CART & PURCHASE RULES (Phase 3)
# ============================================================================
- rule: View cart anytime
  steps:
  - intent: view_cart
  - action: action_view_cart

# Note: Cart form flow temporarily simplified
# Full form integration requires more complex story/rule setup
- rule: Add to cart direct
  steps:
  - intent: add_to_cart
  - action: action_add_to_cart

- rule: Add to cart with size informed
  steps:
  - intent: inform_size
  - action: action_add_to_cart

- rule: Add to cart with color informed
  steps:
  - intent: inform_color
  - action: action_add_to_cart

- rule: Add to cart with quantity informed
  steps:
  - intent: inform_quantity
  - action: action_add_to_cart

# ============================================================================
# 5. DIRECT ACTION RULES (Single-turn interactions)
# ============================================================================
- rule: Ask contact information
  steps:
  - intent: ask_contact_info
  - action: utter_contact_info

- rule: Ask shipping policy
  steps:
  - intent: ask_shipping_policy
  - action: action_get_shipping_policy

- rule: Ask return policy
  steps:
  - intent: ask_return_policy
  - action: action_get_return_policy

- rule: Ask payment methods
  steps:
  - intent: ask_payment_methods
  - action: action_get_payment_methods

- rule: Ask warranty information
  steps:
  - intent: ask_warranty
  - action: action_get_warranty_policy

# ============================================================================
# 6. SUPPORT TICKET RULES
# ============================================================================
- rule: Create support ticket on explicit request
  steps:
  - intent: create_support_ticket
  - action: action_create_support_ticket

# ============================================================================
# 7. FASHION E-COMMERCE RULES (Single-turn Q&A)
# ============================================================================
- rule: Provide size guide
  steps:
  - intent: ask_size_guide
  - action: utter_size_guide

- rule: Provide material information
  steps:
  - intent: ask_material
  - action: utter_material_info

- rule: Show available colors
  steps:
  - intent: ask_available_colors
  - action: utter_colors_available

- rule: Show promotions
  steps:
  - intent: ask_promotions
  - action: utter_promotions_info

- rule: Provide delivery time
  steps:
  - intent: ask_delivery_time
  - action: utter_delivery_info

- rule: Provide fit information
  steps:
  - intent: ask_fit_style
  - action: utter_fit_info

- rule: Show reviews
  steps:
  - intent: ask_reviews
  - action: utter_reviews_info

# ============================================================================
# 8. ADVANCED E-COMMERCE RULES (Single-turn triggers)
# ============================================================================
- rule: Get sizing advice
  steps:
  - intent: ask_sizing_advice
  - action: action_get_sizing_advice

- rule: Get product care info
  steps:
  - intent: ask_product_care
  - action: action_get_product_care

- rule: Report order error
  steps:
  - intent: report_order_error
  - action: action_report_order_error

- rule: Request return or exchange
  steps:
  - intent: request_exchange_item
  - action: action_request_return_or_exchange

- rule: Report quality issue
  steps:
  - intent: report_quality_issue
  - action: action_report_quality_issue

- rule: Handle policy exception request
  steps:
  - intent: request_policy_exception
  - action: action_handle_policy_exception

- rule: Set stock notification
  steps:
  - intent: request_stock_notification_conditional
  - action: action_set_stock_notification

- rule: Check discount logic
  steps:
  - intent: check_discount_logic
  - action: action_check_discount

- rule: Contextual product comparison
  steps:
  - intent: ask_product_comparison_contextual
  - action: action_compare_products

# ============================================================================
# 9. ACTIVATION RULES (Always listen for these)
# ============================================================================
- rule: Always respond to greet in the middle of conversation
  conversation_start: false
  steps:
  - intent: greet
  - action: utter_greet

- rule: Always respond to goodbye in the middle of conversation
  conversation_start: false
  steps:
  - intent: goodbye
  - action: utter_goodbye
